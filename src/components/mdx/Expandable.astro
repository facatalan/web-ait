---
interface Props {
  title: string;
  defaultOpen?: boolean;
  downloadUrl?: string;
  type?: 'recurso' | 'actividad';
}

const { title, defaultOpen = false, downloadUrl, type } = Astro.props;

const typeConfig = {
  recurso: {
    label: 'Recurso',
    tagClass: 'bg-accent-blue/20 text-accent-blue',
    borderClass: 'border-accent-blue/30',
  },
  actividad: {
    label: 'Actividad',
    tagClass: 'bg-accent-purple/20 text-accent-purple',
    borderClass: 'border-accent-purple/30',
  },
};

const config = type ? typeConfig[type] : null;
---

<details class:list={["group bg-dark-800 border rounded-lg overflow-hidden", config ? config.borderClass : "border-white/10"]} open={defaultOpen}>
  <summary class="flex items-center justify-between p-4 cursor-pointer hover:bg-dark-700 transition-colors list-none">
    <div class="flex items-center gap-3">
      {config && (
        <span class:list={["text-xs font-medium px-2 py-0.5 rounded-full", config.tagClass]}>
          {config.label}
        </span>
      )}
      <span class="font-medium text-white">{title}</span>
    </div>
    <div class="flex items-center gap-2">
      {downloadUrl && (
        <a
          href={downloadUrl}
          download
          class="download-button p-2 rounded-lg bg-dark-700 hover:bg-accent-blue/20 hover:text-accent-blue transition-colors"
          onclick={(e: Event) => e.stopPropagation()}
          title="Descargar archivo"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
        </a>
      )}
      <svg
        class="w-5 h-5 text-gray-400 transition-transform group-open:rotate-180"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </div>
  </summary>
  <div class="expandable-content p-4 pt-2 border-t border-white/10 prose prose-invert prose-sm max-w-none">
    <slot />
  </div>
</details>

<style>
  details summary::-webkit-details-marker {
    display: none;
  }

  /* Interlineado más compacto dentro del expandible */
  .expandable-content {
    line-height: 1.5;
  }

  .expandable-content :global(p) {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }

  .expandable-content :global(ul),
  .expandable-content :global(ol) {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    padding-left: 1.25em;
  }

  .expandable-content :global(li) {
    margin-top: 0.25em;
    margin-bottom: 0.25em;
  }

  .expandable-content :global(h1),
  .expandable-content :global(h2),
  .expandable-content :global(h3),
  .expandable-content :global(h4) {
    margin-top: 1em;
    margin-bottom: 0.5em;
  }

  .expandable-content :global(hr) {
    margin-top: 1em;
    margin-bottom: 1em;
  }

  .expandable-content :global(table) {
    margin-top: 0.75em;
    margin-bottom: 0.75em;
  }

  .expandable-content :global(blockquote) {
    margin-top: 0.75em;
    margin-bottom: 0.75em;
  }

  /* Texto monoespaciado más compacto */
  .expandable-content :global(pre),
  .expandable-content :global(code) {
    line-height: 1.3;
  }

  .expandable-content :global(pre) {
    margin-top: 0.75em;
    margin-bottom: 0.75em;
    padding: 0.75em;
  }
</style>
