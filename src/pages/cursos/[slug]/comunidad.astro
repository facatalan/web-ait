---
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/astro/Header.astro';
import Footer from '../../../components/astro/Footer.astro';
import { getCollection } from 'astro:content';
import { Feed } from '../../../components/react/community/Feed';

export async function getStaticPaths() {
  const allLessons = await getCollection('cursos');

  // Obtener cursos Ãºnicos
  const courses = [...new Set(allLessons.map((l) => l.data.course))];

  return courses.map((courseSlug) => {
    const courseLesson = allLessons.find((l) => l.data.course === courseSlug);
    return {
      params: { slug: courseSlug },
      props: {
        courseTitle: courseLesson?.data.courseTitle || courseSlug,
      },
    };
  });
}

const { slug } = Astro.params;
const { courseTitle } = Astro.props;
---

<Layout title={`Comunidad - ${courseTitle}`}>
  <Header />
  <main class="min-h-screen pt-24 pb-16">
    <div class="max-w-2xl mx-auto px-4">
      <!-- Back link -->
      <a
        href={`/cursos/${slug}`}
        class="inline-flex items-center gap-2 text-gray-400 hover:text-white mb-6 transition-colors"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Volver al curso
      </a>

      <Feed client:load courseSlug={slug} courseTitle={courseTitle} />
    </div>
  </main>
  <Footer />
</Layout>
